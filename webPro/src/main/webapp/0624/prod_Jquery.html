<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" href="../css/outStyle.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
<script src="../js/jquery-3.6.0.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<style>
	#details{
		font-size: 1.5em;
	}
</style>
</head>
<body>
	<div class="col-md-3">
		<select class="form-control" id="lprod">
			<option value='0'></option>
		</select>
	</div>

	<div class="col-md-3">
		<select class="form-control" id="prod">
			<option value='no'></option>
		</select>
	</div>

	<br><br>
	
	<div id='details'>[상세정보]</div>
<script>
//jquery로 ajax - lprod
$.ajax({
	url : './jsp/lprod_JSON.jsp',
	success : function(data){
		//select id영역에 뿌려주기
		let result = "";
		$.each(data, function(i){
			result += `<option value='${data[i].lprod_gu}'>${data[i].lprod_nm}</option>`;
		});
		$('#lprod').append(result);
	},
	error : function(xhr){
		alert(xhr.status);
	},
	dataType : 'json'
});
//jquery로 ajax - prod
$('#lprod').on('change',function(){
//	console.log( $(this).val() ); //요청정보
	$.ajax({
		url : './jsp/prod.jsp',
		data : {'lprod_gu' : $(this).val()},
		success:function(data){
			let code = ``;
			if(data.code == "ok"){
			  $.each(data.value, function(i,v){
				code += `<option value='${v.prodId}'>${this.prodNm}</option>`;
			  });
			  $('#prod').append(code);	
			}else{	//데이터 없을 때
			  code += `<option value='0'>데이터 없음</option>`;
			  $('#prod').append(code);	
			}
		},
		error:function(xhr){
			alert(xhr.status);
		},
		dataType: 'json'
	});
});
//jquery로 ajax - prod detail
$('#prod').on('change',function(){
	$.ajax({
		url : './jsp/prodDetails.jsp',
		data : {'prodId' : $(this).val()},
		success : function(data){
			let rst = ``;
			if(data.code == "ok"){
				$.each(data.value, function(i,v){
					rst += `<div class='prodDetails'>`;
					rst += `[상세정보]<br/>`;
					rst += `상품명 : ${this.prodName}<br/>`;
					rst += `상품 코드 : ${v.prodId}<br/>`;
					rst += `상품 가격 : ${v.prodPrice}<br/>`;
					rst += `상품 사이즈 : ${v.prodSize}<br/>`;
					rst += `상품 색상 : ${v.prodColor}<br/>`;
					rst += `상품 설명 : ${v.prodOutline}<br/>`;
					rst += `</div>`;
				});
			}else{
				rst += `<div>다른 상품을 선택해주세요</div>`;
			}
			$('#details').append(rst);
		},
		error : function(xhr){
			alert(xhr.status);
		},
		dataType : 'json'
	});
	$('#prod').empty();
	$('#details').empty();
});
</script>
</body>
</html>